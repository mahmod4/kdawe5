<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>سلة التسوق</title>
  <link rel="stylesheet" href="./css/styles.css" />
  <link rel="stylesheet" href="./css/weight.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="./js/ui.js"></script>
  <script src="./js/runtime-env-client.js"></script>
  <script src="./js/order-service.js"></script>
  <script src="./js/favorites.js"></script>
  
  <!-- Firebase SDK -->
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, query, where, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";
    
    // تكوين Firebase
    const env = (window.RUNTIME_ENV && typeof window.RUNTIME_ENV === 'object') ? window.RUNTIME_ENV : {};
    const firebaseConfig = {
      apiKey: env.FIREBASE_API_KEY || "AIzaSyAWkruoIMbTxD-5DHCpspPY8p2TtZLLmLM",
      authDomain: env.FIREBASE_AUTH_DOMAIN || "dashboard-27bc8.firebaseapp.com",
      projectId: env.FIREBASE_PROJECT_ID || "dashboard-27bc8",
      storageBucket: env.FIREBASE_STORAGE_BUCKET || "dashboard-27bc8.firebasestorage.app",
      messagingSenderId: env.FIREBASE_MESSAGING_SENDER_ID || "707339591256",
      appId: env.FIREBASE_APP_ID || "1:707339591256:web:dcc2649182e97249a2742d",
      measurementId: env.FIREBASE_MEASUREMENT_ID || "G-K8FNNYH4S1"
    };

    // تهيئة Firebase
    try {
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);
      
      // جعل Firebase متاحاً عالمياً
      window.firebase = {
        app,
        auth: () => auth,
        firestore: () => db
      };
      
      // جعل الدوال متاحة عالمياً
      window.firebaseAuth = {
        GoogleAuthProvider,
        signInWithPopup,
        signOut,
        onAuthStateChanged
      };
      
      window.firebaseFirestore = {
        collection,
        addDoc,
        query,
        where,
        orderBy,
        getDocs
      };
      
      console.log('تم تهيئة Firebase بنجاح');
    } catch (error) {
      console.error('خطأ في تهيئة Firebase:', error);
    }
  </script>
</head>
<body>
  <header>
    <div class="logo-container">
      <a href="index.html" style="display:flex; align-items:center; gap:10px; text-decoration:none; color:inherit;">
        <img src="../images/default-logo.png" alt="شعار المتجر" class="logo" width="60" height="60" data-store-logo />
        <h1 data-store-name>المتجر</h1>
      </a>
    </div>
    <nav class="main-menu" id="main-menu">
      <ul>
        <li><a href="index.html#home" class="menu-item"><i data-lucide="home"></i> الرئيسية</a></li>
        <li><a href="index.html#products" class="menu-item"><i data-lucide="shopping-bag"></i> المنتجات</a></li>
        <li><a href="index.html#daily-offers" class="menu-item"><i data-lucide="zap"></i> العروض اليومية</a></li>
        <li><a href="contact.html" class="menu-item"><i data-lucide="store"></i> عن المتجر</a></li>
      </ul>
    </nav>
    <div class="navbar-cart">
      <a href="#" style="pointer-events:none; opacity:0.9;"><i data-lucide="shopping-cart"></i><span>سلة التسوق</span><span id="cart-count-desktop">0</span></a>
    </div>
  </header>

  <main class="container" style="padding: 20px 16px; max-width: 900px; margin: 0 auto;">
    <h2 style="margin-bottom:16px;">سلة التسوق</h2>

    <div id="cart-page-items">
      <!-- عناصر السلة سيتم إدراجها هنا -->
    </div>

    <div id="cart-summary" class="cart-total" style="margin-top:16px;">
      <p>المجموع: <span id="subtotal-amount">0</span> ج.م</p>
      <p>التوصيل: <span id="delivery-fee">20</span> ج.م</p>
      <hr />
      <p><strong>الإجمالي: <span id="grand-total">20</span> ج.م</strong></p>
    </div>

    <div id="order-extra" style="margin-top:16px; display:flex; flex-direction:column; gap:12px;">
      <div>
        <label for="note-input" style="display:block; margin-bottom:6px;">ملاحظة للطلب (اختياري)</label>
        <textarea id="note-input" placeholder="أكتب ملاحظة مثل:، وقت التوصيل المناسب..." rows="3" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:8px; resize:vertical;"></textarea>
      </div>
      <div>
        <p style="margin:0 0 8px;">طريقة الدفع</p>
        <div style="display:flex; gap:16px; align-items:center; flex-wrap:wrap;">
          <label style="display:flex; align-items:center; gap:6px; cursor:pointer;">
            <input type="radio" name="payment-method" value="cash" checked />
            <span>كاش عند الاستلام</span>
          </label>
          <label style="display:flex; align-items:center; gap:6px; cursor:pointer;">
            <input type="radio" name="payment-method" value="visa" />
            <span>فيزا</span>
          </label>
        </div>
      </div>
    </div>

    <div id="customer-details" style="display:none; gap:10px; margin-top:16px; flex-direction:column;">
      <h3 style="margin:0 0 8px;">بيانات العميل</h3>
      <div style="display:flex; gap:10px; flex-wrap:wrap;">
        <div style="flex:1; min-width:180px;">
          <label for="first-name" style="display:block; margin-bottom:6px;">الاسم الأول</label>
          <input id="first-name" type="text" placeholder="الاسم الأول" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:8px;" />
        </div>
        <div style="flex:1; min-width:180px;">
          <label for="last-name" style="display:block; margin-bottom:6px;">الاسم الثاني</label>
          <input id="last-name" type="text" placeholder="الاسم الثاني" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:8px;" />
        </div>
      </div>
      <div>
        <label for="address" style="display:block; margin-bottom:6px;">العنوان</label>
        <input id="address" type="text" placeholder="العنوان الكامل" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:8px;" />
      </div>
      <div>
        <label for="phone" style="display:block; margin-bottom:6px;">رقم الهاتف</label>
        <input id="phone" type="tel" placeholder="مثال: 01XXXXXXXXX" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:8px;" />
      </div>
    </div>

    <div style="display:flex; gap:10px; margin-top:16px;">
      <a href="index.html#products" class="btn" style="flex:1; text-align:center;">متابعة التسوق</a>
      <button id="continue-details-btn" class="btn" style="flex:1;">المتابعة لإتمام الطلب</button>
    </div>

    <div style="display:flex; gap:10px; margin-top:10px;">
      <button id="checkout-btn" class="btn" style="flex:1; display:none;">
        إتمام الشراء عبر واتساب <i class="fab fa-whatsapp"></i>
      </button>
    </div>
  </main>

  <script src="./js/settings.js"></script>
  <script src="./js/settings-sync.js" type="module"></script>
  <script>lucide.createIcons();</script>
  <script src="./js/cart.js"></script>
</body>
</html>

